import{a,f as g,c as I,t as N}from"../chunks/CeFSxQbd.js";import{p as at,o as st,f as z,t as T,a as nt,s as y,g as e,e as ot,c as s,b as V,$ as it,d,r,n as X,u as ee,h as he}from"../chunks/BRtkYQ1n.js";import{d as dt,s as $}from"../chunks/E6HBHZWA.js";import{i as K,c as H}from"../chunks/B9s1PaqY.js";import{h as lt,f as vt,r as ut,s as ct,e as te,i as re,a as O,b as ft}from"../chunks/Dccx3I4d.js";import{s as ae}from"../chunks/C7_CdJMd.js";import{s as mt,a as pt}from"../chunks/CIQlyMqn.js";import{g as Fe}from"../chunks/DBs4nQ8k.js";import{p as _t}from"../chunks/DaDaNdxn.js";import{S as gt,a as xt,b as me,c as bt}from"../chunks/B6rEL-Bb.js";var ht=g('<span class="text-sm text-muted-foreground"> </span>'),wt=g("<!> <!> <!> <!> <!>",1),yt=g("<!> <!>",1),$t=g('<div class="flex-1 flex items-center justify-center text-muted-foreground">Loading...</div>'),kt=g('<div class="flex-1 flex items-center justify-center text-destructive"> </div>'),Ct=g('<div class="sticky top-0 z-20 bg-background border-b border-r px-3 py-2"><div class="font-medium"> </div> <div class="text-xs text-muted-foreground"> </div></div>'),Pt=g('<a><div class="flex items-start justify-between gap-2"><span class="text-xs text-muted-foreground"> </span> <span></span></div> <div class="text-sm line-clamp-2 mt-1"> </div> <div class="flex items-center justify-between mt-2"><span class="w-6 h-6 rounded-full bg-muted flex items-center justify-center text-xs"> </span></div></a>'),Lt=g('<div class="border-b border-r p-2 min-h-[100px] bg-background"><div class="space-y-2"></div></div>'),St=g('<div class="sticky left-0 z-10 bg-muted/50 border-b border-r px-3 py-2 font-medium truncate"> </div> <!>',1),Dt=g('<div class="grid min-w-max"><div class="sticky top-0 left-0 z-30 bg-background border-b border-r px-3 py-2"></div> <!> <!></div>'),jt=g('<a><div class="flex items-start justify-between gap-2"><span class="text-xs text-muted-foreground"> </span> <span></span></div> <div class="text-sm line-clamp-2 mt-1"> </div> <div class="flex items-center justify-between mt-2"><span class="w-6 h-6 rounded-full bg-muted flex items-center justify-center text-xs"> </span></div></a>'),Ut=g('<div><div><div class="font-medium"> </div> <div class="text-xs text-muted-foreground"> </div></div> <div class="flex-1 overflow-y-auto p-2 space-y-2"></div></div>'),Bt=g('<div class="flex min-w-max h-full"></div>'),At=g('<div class="flex-1 overflow-auto"><!></div>'),Et=g('<div class="h-screen flex flex-col"><div class="flex-none border-b bg-background px-4 py-3"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><h1 class="text-xl font-semibold">Kanban Board</h1> <!></div> <div class="flex items-center gap-4"><!> <label class="flex items-center gap-2 text-sm"><input type="checkbox" class="rounded border-input"/> Show hidden</label></div></div></div> <!></div> <div class="fixed bottom-4 left-4 text-xs text-muted-foreground bg-background/90 backdrop-blur-sm px-2 py-1 rounded border"><kbd class="font-mono bg-muted px-1 py-0.5 rounded">Arrow keys</kbd> navigate <kbd class="font-mono bg-muted px-1 py-0.5 rounded ml-2">Enter</kbd> open</div>',1);function qt(Re,Te){at(Te,!0);const Ke=()=>pt(_t,"$page",Oe),[Oe,He]=mt();let l=V(null),we=V(!0),pe=V(null),B=V(""),G=V(!1),k=V(0),S=V(0),_e=0,Le=he(()=>{if(!e(l))return new Map;const t=new Map;for(const n of e(l).columns)t.set(n,[]);for(const n of e(l).defects){const v=n.status||"Unknown",x=e(l).columns.find(D=>D.toLowerCase()===v.toLowerCase())||v;t.has(x)||t.set(x,[]),t.get(x).push(n)}return t});function se(t,n){const v=e(Le).get(t)||[];return!n||!e(l)?.lane_field?v:v.filter(x=>x[e(l).lane_field]===n)}function We(t){return e(Le).get(t)?.length||0}function Se(t){return t?t.includes("1")?"bg-red-500":t.includes("2")?"bg-orange-500":t.includes("3")?"bg-yellow-500":t.includes("4")?"bg-green-500":"bg-muted":"bg-muted"}function De(t){if(!t)return"?";const n=t.split("_")[0].split("@")[0],v=n.split(".");return v.length>=2?(v[0][0]+v[1][0]).toUpperCase():n.slice(0,2).toUpperCase()}async function ye(){y(we,!0),y(pe,null);try{y(l,await vt({lane:e(B)||void 0,include_hidden:e(G)}),!0)}catch(t){y(pe,t instanceof Error?t.message:"Failed to load kanban",!0)}finally{y(we,!1)}}function qe(t){y(B,t,!0),je(),ye()}function Ve(){y(G,!e(G)),je(),ye()}function je(){const t=new URLSearchParams;e(B)&&t.set("lane",e(B)),e(G)&&t.set("include_hidden","true");const n=t.toString();Fe(n?`?${n}`:"/kanban",{replaceState:!0,noScroll:!0})}function Ue(t){const n=t.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||!e(l))return;const x=e(l).columns,D=e(l).lanes.length>0?e(l).lanes:[null];switch(t.key){case"ArrowRight":e(k)<x.length-1&&(ee(k),y(S,0)),t.preventDefault();break;case"ArrowLeft":e(k)>0&&(ee(k,-1),y(S,0)),t.preventDefault();break;case"ArrowDown":case"j":{const p=x[e(k)],b=D[_e],h=se(p,b??void 0);e(S)<h.length-1?ee(S):e(k)<x.length-1&&(ee(k),y(S,0)),t.preventDefault();break}case"ArrowUp":case"k":{if(e(S)>0)ee(S,-1);else if(e(k)>0){ee(k,-1);const p=x[e(k)],b=D[_e],h=se(p,b??void 0);y(S,Math.max(0,h.length-1),!0)}t.preventDefault();break}case"Enter":{const p=x[e(k)],b=D[_e],h=se(p,b??void 0);h[e(S)]&&Fe(`/defects/${h[e(S)].id}`),t.preventDefault();break}}setTimeout(()=>{document.querySelector('[data-focused="true"]')?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},0)}st(()=>{const t=new URLSearchParams(Ke().url.search);return y(B,t.get("lane")||"",!0),y(G,t.get("include_hidden")==="true"),ye(),window.addEventListener("keydown",Ue),()=>window.removeEventListener("keydown",Ue)});function ge(t,n,v=0){return e(k)===t&&e(S)===n&&_e===v}var Be=Et();lt("1hrva9w",t=>{ot(()=>{it.title="Kanban - ALM Defects"})});var Ae=z(Be),$e=s(Ae),Ee=s($e),ke=s(Ee),Xe=d(s(ke),2);{var Ge=t=>{var n=ht(),v=s(n);r(n),T(()=>$(v,`${e(l).defects.length??""} defects`)),a(t,n)};K(Xe,t=>{e(l)&&t(Ge)})}r(ke);var Me=d(ke,2),Ne=s(Me);H(Ne,()=>bt,(t,n)=>{n(t,{type:"single",get value(){return e(B)},onValueChange:qe,children:(v,x)=>{var D=yt(),p=z(D);H(p,()=>gt,(h,ne)=>{ne(h,{class:"w-40",children:(W,oe)=>{var q=I(),J=z(q);{var Q=_=>{var w=N("By Priority");a(_,w)},j=_=>{var w=I(),f=z(w);{var u=i=>{var o=N("By Owner");a(i,o)},c=i=>{var o=I(),C=z(o);{var A=P=>{var U=N("By Module");a(P,U)},F=P=>{var U=I(),ie=z(U);{var L=m=>{var E=N("By Workstream");a(m,E)},Y=m=>{var E=N("No Swimlanes");a(m,E)};K(ie,m=>{e(B)==="workstream"?m(L):m(Y,!1)},!0)}a(P,U)};K(C,P=>{e(B)==="module"?P(A):P(F,!1)},!0)}a(i,o)};K(f,i=>{e(B)==="owner"?i(u):i(c,!1)},!0)}a(_,w)};K(J,_=>{e(B)==="priority"?_(Q):_(j,!1)})}a(W,q)},$$slots:{default:!0}})});var b=d(p,2);H(b,()=>xt,(h,ne)=>{ne(h,{children:(W,oe)=>{var q=wt(),J=z(q);H(J,()=>me,(f,u)=>{u(f,{value:"",children:(c,i)=>{X();var o=N("No Swimlanes");a(c,o)},$$slots:{default:!0}})});var Q=d(J,2);H(Q,()=>me,(f,u)=>{u(f,{value:"priority",children:(c,i)=>{X();var o=N("By Priority");a(c,o)},$$slots:{default:!0}})});var j=d(Q,2);H(j,()=>me,(f,u)=>{u(f,{value:"owner",children:(c,i)=>{X();var o=N("By Owner");a(c,o)},$$slots:{default:!0}})});var _=d(j,2);H(_,()=>me,(f,u)=>{u(f,{value:"module",children:(c,i)=>{X();var o=N("By Module");a(c,o)},$$slots:{default:!0}})});var w=d(_,2);H(w,()=>me,(f,u)=>{u(f,{value:"workstream",children:(c,i)=>{X();var o=N("By Workstream");a(c,o)},$$slots:{default:!0}})}),a(W,q)},$$slots:{default:!0}})}),a(v,D)},$$slots:{default:!0}})});var ze=d(Ne,2),Ce=s(ze);ut(Ce),Ce.__change=Ve,X(),r(ze),r(Me),r(Ee),r($e);var Je=d($e,2);{var Qe=t=>{var n=$t();a(t,n)},Ye=t=>{var n=I(),v=z(n);{var x=p=>{var b=kt(),h=s(b,!0);r(b),T(()=>$(h,e(pe))),a(p,b)},D=p=>{var b=I(),h=z(b);{var ne=W=>{var oe=At(),q=s(oe);{var J=j=>{const _=he(()=>`12rem repeat(${e(l).columns.length}, 16rem)`);var w=Dt(),f=d(s(w),2);te(f,17,()=>e(l).columns,re,(c,i)=>{var o=Ct(),C=s(o),A=s(C,!0);r(C);var F=d(C,2),P=s(F,!0);r(F),r(o),T(U=>{$(A,e(i)),$(P,U)},[()=>We(e(i))]),a(c,o)});var u=d(f,2);te(u,17,()=>e(l).lanes,re,(c,i,o)=>{var C=St(),A=z(C),F=s(A,!0);r(A);var P=d(A,2);te(P,17,()=>e(l).columns,re,(U,ie,L)=>{const Y=he(()=>se(e(ie),e(i)));var m=Lt(),E=s(m);te(E,21,()=>e(Y),re,(de,R,le)=>{var M=Pt(),ve=s(M),Z=s(ve),ue=s(Z);r(Z);var xe=d(Z,2);r(ve);var ce=d(ve,2),Pe=s(ce,!0);r(ce);var be=d(ce,2),fe=s(be),Ze=s(fe,!0);r(fe),r(be),r(M),T((Ie,et,tt,rt)=>{O(M,"href",`/defects/${e(R).id??""}`),ae(M,1,`block p-2 bg-card border rounded shadow-sm hover:shadow-md transition-shadow ${Ie??""}`),O(M,"data-focused",et),$(ue,`#${e(R).id??""}`),ae(xe,1,`w-2 h-2 rounded-full flex-none ${tt??""}`),O(xe,"title",e(R).priority||"No priority"),$(Pe,e(R).name),O(fe,"title",e(R).owner||"Unassigned"),$(Ze,rt)},[()=>ge(L,le,o)?"ring-2 ring-primary":"",()=>ge(L,le,o),()=>Se(e(R).priority),()=>De(e(R).owner)]),a(de,M)}),r(E),r(m),a(U,m)}),T(()=>{O(A,"title",e(i)),$(F,e(i))}),a(c,C)}),r(w),T(()=>ft(w,`grid-template-columns: ${e(_)??""};`)),a(j,w)},Q=j=>{var _=Bt();te(_,21,()=>e(l).columns,re,(w,f,u)=>{const c=he(()=>se(e(f)));var i=Ut();ae(i,1,`w-64 flex-none flex flex-col border-r ${u===0?"sticky left-0 z-20 bg-background":""}`);var o=s(i);ae(o,1,`sticky top-0 bg-background border-b px-3 py-2 ${u===0?"z-30":"z-10"}`);var C=s(o),A=s(C,!0);r(C);var F=d(C,2),P=s(F);r(F),r(o);var U=d(o,2);te(U,21,()=>e(c),re,(ie,L,Y)=>{var m=jt(),E=s(m),de=s(E),R=s(de);r(de);var le=d(de,2);r(E);var M=d(E,2),ve=s(M,!0);r(M);var Z=d(M,2),ue=s(Z),xe=s(ue,!0);r(ue),r(Z),r(m),T((ce,Pe,be,fe)=>{O(m,"href",`/defects/${e(L).id??""}`),ae(m,1,`block p-2 bg-card border rounded shadow-sm hover:shadow-md transition-shadow ${ce??""}`),O(m,"data-focused",Pe),$(R,`#${e(L).id??""}`),ae(le,1,`w-2 h-2 rounded-full flex-none ${be??""}`),O(le,"title",e(L).priority||"No priority"),$(ve,e(L).name),O(ue,"title",e(L).owner||"Unassigned"),$(xe,fe)},[()=>ge(u,Y)?"ring-2 ring-primary":"",()=>ge(u,Y),()=>Se(e(L).priority),()=>De(e(L).owner)]),a(ie,m)}),r(U),r(i),T(()=>{$(A,e(f)),$(P,`${e(c).length??""} defects`)}),a(w,i)}),r(_),a(j,_)};K(q,j=>{e(l).lanes.length>0?j(J):j(Q,!1)})}r(oe),a(W,oe)};K(h,W=>{e(l)&&W(ne)},!0)}a(p,b)};K(v,p=>{e(pe)?p(x):p(D,!1)},!0)}a(t,n)};K(Je,t=>{e(we)?t(Qe):t(Ye,!1)})}r(Ae),X(2),T(()=>ct(Ce,e(G))),a(Re,Be),nt(),He()}dt(["change"]);export{qt as component};
